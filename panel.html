<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DE LA MODULAR â€” Layout</title>

<link href="https://fonts.googleapis.com/css2?family=Bevan&display=swap" rel="stylesheet">

<style>

/* =========================
   COLOR DOCTRINE (ALIGNED)
========================= */

:root {
    --primary-font: "DIN1451", "Bahnschrift", "Arial Narrow", sans-serif;

    --bg: #0a0312;
    --panel: #0a0312;
    --text: #f0e6fb;
    --muted: rgba(240,230,250,0.6);
    --line: rgba(240,230,250,0.08);
    --accent: #e84b76;

    --max-width: 1200px;
}

* { box-sizing: border-box; }

body {
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: var(--primary-font);
    line-height: 1.6;
}

/* =========================
   NAV (same structure)
========================= */

nav {
    position: fixed;
    width: 100%;
    background: var(--bg);
    border-bottom: 1px solid var(--line);
    z-index: 10;
}

.nav-inner {
    max-width: var(--max-width);
    margin: auto;
    padding: 20px 24px 12px 24px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.logo img {
    width: 83px;
    height: 83px;
    display: block;
}

.logo::after {
    content: "";
    height: 1px;
    width: 28px;
    background: var(--accent);
    margin-top: 6px;
    display: block;
}

.nav-links {
    padding-top: 28px;
}

.nav-links a {
    margin-left: 32px;
    text-decoration: none;
    color: var(--text);
    font-size: 13px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    opacity: 0.75;
}

.nav-links a:hover {
    color: var(--accent);
    opacity: 1;
}

/* =========================
   SECTION
========================= */

section {
    padding: 160px 24px 140px 24px;
}

.wrapper {
    max-width: var(--max-width);
    margin: auto;
}

h1 {
    font-size: 28px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 40px;
}

/* =========================
   CONTROLS
========================= */

.controls {
    border: 1px solid var(--line);
    padding: 24px;
    margin-bottom: 60px;
}

input, button {
    background: transparent;
    border: 1px solid var(--text);
    color: var(--text);
    padding: 10px 14px;
    margin-right: 10px;
    font-family: var(--primary-font);
}

button:hover {
    border-color: var(--accent);
    color: var(--accent);
    cursor: pointer;
}

/* =========================
   SVG STRUCTURE
========================= */

svg {
    border: 1px solid var(--line);
    background: transparent;
}

.module rect {
    fill: none;
    stroke: var(--text);
    stroke-width: 0.6;
}

.module text {
    fill: var(--text);
    font-size: 4px;
    pointer-events: none;
}

.rail-slot {
    fill: none;
    stroke: var(--text);
    stroke-width: 0.4;
    opacity: 0.15;
}

.frame {
    fill: none;
    stroke: var(--text);
    stroke-width: 0.8;
}

.stats {
    margin-top: 20px;
    font-size: 13px;
    color: var(--muted);
}

</style>
</head>
<body>

<nav>
    <div class="nav-inner">
        <div class="logo">
            <img src="logo_text.svg" alt="DE LA MODULAR">
        </div>
        <div class="nav-links">
            <a href="#">Cases</a>
            <a href="#">Custom</a>
            <a href="#">About</a>
        </div>
    </div>
</nav>

<section>
<div class="wrapper">

<h1>Panel Layout</h1>

<div class="controls">
    Row Width (HP):
    <input type="number" id="rowHP" value="84">
    <button onclick="createRow()">Create</button>
    <button onclick="exportSVG()">Download SVG</button>
</div>

<div id="layoutContainer"></div>

</div>
</section>

<script>

/* =========================
   CONSTANTS
========================= */

const HP_TO_MM = 5.08;
const ROW_HEIGHT = 128.5;
const HOLE_OFFSET = 2.54;
const SLOT_WIDTH = 3.2;
const SLOT_LENGTH = 6.5;
const RAIL_TOP_Y = 7;
const RAIL_BOTTOM_Y = ROW_HEIGHT - 7;

/* ========================= */

let row = null;
let activeModule = null;

function createRow(){
    const hp = parseInt(document.getElementById("rowHP").value);
    if(!hp) return;

    row = {
        hp: hp,
        widthMM: hp * HP_TO_MM,
        modules: []
    };

    render();
}

function addModule(){
    if(!row) return;

    const name = prompt("Module name?");
    const hp = parseInt(prompt("HP size?"));
    if(!hp) return;

    row.modules.push({
        name: name.toUpperCase(),
        hp: hp,
        width: hp * HP_TO_MM,
        x: 0
    });

    render();
}

/* =========================
   RENDER
========================= */

function render(){

    const container = document.getElementById("layoutContainer");
    container.innerHTML = "";

    if(!row) return;

    const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
    svg.setAttribute("width", row.widthMM + "mm");
    svg.setAttribute("height", ROW_HEIGHT + "mm");
    svg.setAttribute("viewBox", `0 0 ${row.widthMM} ${ROW_HEIGHT}`);

    const frame = document.createElementNS(svg.namespaceURI,"rect");
    frame.setAttribute("class","frame");
    frame.setAttribute("width",row.widthMM);
    frame.setAttribute("height",ROW_HEIGHT);
    svg.appendChild(frame);

    drawRailSlots(svg);

    row.modules.forEach(mod=>{
        const g = document.createElementNS(svg.namespaceURI,"g");
        g.setAttribute("class","module");
        g.setAttribute("transform",`translate(${mod.x},0)`);

        const rect = document.createElementNS(svg.namespaceURI,"rect");
        rect.setAttribute("width",mod.width);
        rect.setAttribute("height",ROW_HEIGHT);

        const text = document.createElementNS(svg.namespaceURI,"text");
        text.setAttribute("x",mod.width/2);
        text.setAttribute("y",ROW_HEIGHT/2);
        text.setAttribute("text-anchor","middle");
        text.textContent = mod.name;

        g.appendChild(rect);
        g.appendChild(text);

        enableDrag(g, mod);

        svg.appendChild(g);
    });

    container.appendChild(svg);

    const addBtn = document.createElement("button");
    addBtn.textContent = "Add Module";
    addBtn.onclick = addModule;
    container.appendChild(addBtn);
}

/* =========================
   RAIL SLOTS
========================= */

function drawRailSlots(svg){

    for(let i=0;i<=row.hp;i++){

        const x = i * HP_TO_MM + HOLE_OFFSET;

        drawSlot(svg, x, RAIL_TOP_Y);
        drawSlot(svg, x, RAIL_BOTTOM_Y);
    }
}

function drawSlot(svg, x, y){

    const slot = document.createElementNS(svg.namespaceURI,"rect");
    slot.setAttribute("class","rail-slot");
    slot.setAttribute("x", x - SLOT_LENGTH/2);
    slot.setAttribute("y", y - SLOT_WIDTH/2);
    slot.setAttribute("width", SLOT_LENGTH);
    slot.setAttribute("height", SLOT_WIDTH);

    svg.appendChild(slot);
}

/* =========================
   DRAG SYSTEM (FIXED)
========================= */

function enableDrag(element, module){

    element.addEventListener("pointerdown", e=>{
        activeModule = module;
        element.setPointerCapture(e.pointerId);
    });

    element.addEventListener("pointermove", e=>{
        if(!activeModule) return;

        const pt = element.ownerSVGElement.createSVGPoint();
        pt.x = e.clientX;
        pt.y = e.clientY;

        const cursor = pt.matrixTransform(element.ownerSVGElement.getScreenCTM().inverse());

        let newX = cursor.x - module.width/2;

        newX = Math.round(newX / HP_TO_MM) * HP_TO_MM;

        if(newX < 0) newX = 0;
        if(newX + module.width > row.widthMM)
            newX = row.widthMM - module.width;

        module.x = newX;
        element.setAttribute("transform",`translate(${module.x},0)`);
    });

    element.addEventListener("pointerup", ()=>{
        activeModule = null;
    });
}

/* =========================
   EXPORT
========================= */

function exportSVG(){

    if(!row) return;

    let svgContent = `
<svg xmlns="http://www.w3.org/2000/svg"
width="${row.widthMM}mm"
height="${ROW_HEIGHT}mm"
viewBox="0 0 ${row.widthMM} ${ROW_HEIGHT}">
<rect x="0" y="0" width="${row.widthMM}" height="${ROW_HEIGHT}" fill="none" stroke="black"/>
`;

    for(let i=0;i<=row.hp;i++){
        const x = i * HP_TO_MM + HOLE_OFFSET;

        svgContent += `
<rect x="${x - SLOT_LENGTH/2}"
y="${RAIL_TOP_Y - SLOT_WIDTH/2}"
width="${SLOT_LENGTH}"
height="${SLOT_WIDTH}"
fill="none" stroke="black"/>
<rect x="${x - SLOT_LENGTH/2}"
y="${RAIL_BOTTOM_Y - SLOT_WIDTH/2}"
width="${SLOT_LENGTH}"
height="${SLOT_WIDTH}"
fill="none" stroke="black"/>
`;
    }

    row.modules.forEach(mod=>{
        svgContent+=`
<rect x="${mod.x}" y="0"
width="${mod.width}" height="${ROW_HEIGHT}"
fill="none" stroke="black"/>
`;
    });

    svgContent+=`</svg>`;

    const blob=new Blob([svgContent],{type:"image/svg+xml"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;
    a.download="DE_LA_MODULAR_LAYOUT.svg";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

</script>
</body>
</html>